# æœåŠ¡ç«¯ä¼˜å…ˆç™»å½•æ–¹æ¡ˆ

> **æ–¹æ¡ˆç±»å‹**: å¼ºåˆ¶æœåŠ¡ç«¯ç™»å½• + å¯é€‰ Google ç»‘å®š  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-29  
> **é€‚ç”¨åœºæ™¯**: å•†ä¸šåŒ–è¿è¥ã€ä»˜è´¹è®¢é˜…ã€ä¼ä¸šéƒ¨ç½²  
> **éš¾åº¦**: â­â­â­â­ (è¾ƒé«˜)

---

## ğŸ“‹ ç›®å½•

1. [æ–¹æ¡ˆæ¦‚è¿°](#æ–¹æ¡ˆæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [ç™»å½•æµç¨‹](#ç™»å½•æµç¨‹)
4. [å®¢æˆ·ç«¯å®ç°](#å®¢æˆ·ç«¯å®ç°)
5. [æœåŠ¡ç«¯ API](#æœåŠ¡ç«¯-api)
6. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
7. [æƒé™æ§åˆ¶](#æƒé™æ§åˆ¶)
8. [Google è´¦å·ç»‘å®š](#google-è´¦å·ç»‘å®š)
9. [ç¦»çº¿æ¨¡å¼](#ç¦»çº¿æ¨¡å¼)
10. [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)

---

## æ–¹æ¡ˆæ¦‚è¿°

### æ ¸å¿ƒæ€è·¯

ç”¨æˆ·å¿…é¡»å…ˆç™»å½•ä½ çš„æœåŠ¡ç«¯è´¦å·æ‰èƒ½ä½¿ç”¨ AionUiï¼ŒGoogle è´¦å·å˜ä¸ºå¯é€‰çš„é™„åŠ åŠŸèƒ½ï¼ˆä»…ç”¨äºè®¿é—® Gemini APIï¼‰ã€‚

### ç”¨æˆ·ä½“éªŒæµç¨‹

```
å¯åŠ¨åº”ç”¨
    â†“
æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
    â†“ æœªç™»å½•
æ˜¾ç¤ºç™»å½•ç•Œé¢
    â†“
ç”¨æˆ·ç™»å½•ï¼ˆè´¦å·å¯†ç /æ‰‹æœºéªŒè¯ç /é‚®ç®±ï¼‰
    â†“
æœåŠ¡ç«¯éªŒè¯
    â†“
è¿”å› Token å’Œç”¨æˆ·ä¿¡æ¯
    â†“
è¿›å…¥ä¸»ç•Œé¢
    â†“
(å¯é€‰) éœ€è¦ä½¿ç”¨ Gemini æ—¶ç»‘å®š Google è´¦å·
```

### ä¸ Google ä¼˜å…ˆæ–¹æ¡ˆçš„å¯¹æ¯”

| ç‰¹æ€§         | Google ä¼˜å…ˆæ–¹æ¡ˆ    | æœåŠ¡ç«¯ä¼˜å…ˆæ–¹æ¡ˆ       |
| ------------ | ------------------ | -------------------- |
| ç™»å½•æ–¹å¼     | Google OAuth       | è´¦å·å¯†ç /éªŒè¯ç       |
| æ˜¯å¦éœ€è¦æ³¨å†Œ | å¦ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰     | æ˜¯                   |
| Google è´¦å·  | å¿…é¡»               | å¯é€‰ï¼ˆä»… Gemini ç”¨ï¼‰ |
| ç”¨æˆ·æ§åˆ¶     | ä½                 | é«˜                   |
| ä»˜è´¹è®¢é˜…     | éš¾å®ç°             | æ˜“å®ç°               |
| ç¦»çº¿ä½¿ç”¨     | å¯ä»¥               | å—é™                 |
| å¼€å‘å¤æ‚åº¦   | ä½                 | é«˜                   |
| é€‚ç”¨åœºæ™¯     | å¼€æºé¡¹ç›®ã€ä¸ªäººä½¿ç”¨ | å•†ä¸šåŒ–ã€ä¼ä¸šéƒ¨ç½²     |

### ä¼˜åŠ¿

- âœ… **å®Œå…¨æ§åˆ¶ç”¨æˆ·è®¿é—®** - å¯ä»¥é™åˆ¶æ³¨å†Œã€å®¡æ ¸ç”¨æˆ·
- âœ… **ä»˜è´¹è®¢é˜…** - å¯ä»¥å®ç°ä¼šå‘˜åˆ¶åº¦ã€åŠŸèƒ½åˆ†çº§
- âœ… **æ•°æ®åŒæ­¥** - ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œè·¨è®¾å¤‡åŒæ­¥
- âœ… **ä½¿ç”¨ç»Ÿè®¡** - å¯ä»¥è¿½è¸ªç”¨æˆ·è¡Œä¸ºã€ä½¿ç”¨æƒ…å†µ
- âœ… **å®‰å…¨æ€§é«˜** - å¯ä»¥å®ç° IP ç™½åå•ã€è®¾å¤‡ç»‘å®šç­‰

### åŠ£åŠ¿

- âŒ **ç”¨æˆ·é—¨æ§›é«˜** - éœ€è¦æ³¨å†Œè´¦å·
- âŒ **ä¾èµ–æœåŠ¡ç«¯** - æœåŠ¡ç«¯æ•…éšœå½±å“ä½¿ç”¨
- âŒ **å¼€å‘æˆæœ¬é«˜** - éœ€è¦å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿ
- âŒ **ç»´æŠ¤æˆæœ¬é«˜** - éœ€è¦è¿ç»´æœåŠ¡å™¨

---

## æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AionUi å®¢æˆ·ç«¯                           â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              åº”ç”¨å¯åŠ¨æ£€æŸ¥                             â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  1. è¯»å–æœ¬åœ° Token                                    â”‚  â”‚
â”‚  â”‚  2. Token å­˜åœ¨ï¼Ÿ                                      â”‚  â”‚
â”‚  â”‚     - æ˜¯ â†’ éªŒè¯ Token æœ‰æ•ˆæ€§                          â”‚  â”‚
â”‚  â”‚     - å¦ â†’ æ˜¾ç¤ºç™»å½•çª—å£                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ç™»å½•çª—å£ (æœªç™»å½•æ—¶)                      â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  - è´¦å·å¯†ç ç™»å½•                                       â”‚  â”‚
â”‚  â”‚  - æ‰‹æœºéªŒè¯ç ç™»å½•                                     â”‚  â”‚
â”‚  â”‚  - é‚®ç®±ç™»å½•                                           â”‚  â”‚
â”‚  â”‚  - æ³¨å†Œæ–°è´¦å·                                         â”‚  â”‚
â”‚  â”‚  - å¿˜è®°å¯†ç                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ä¸»çª—å£ (ç™»å½•å)                          â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  - å¯¹è¯ç•Œé¢                                           â”‚  â”‚
â”‚  â”‚  - è®¾ç½®ç•Œé¢                                           â”‚  â”‚
â”‚  â”‚  - ç”¨æˆ·ä¿¡æ¯                                           â”‚  â”‚
â”‚  â”‚  - è®¢é˜…çŠ¶æ€                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Google è´¦å·ç»‘å®š (ä½¿ç”¨ Gemini æ—¶)             â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  1. æ£€æµ‹åˆ°ä½¿ç”¨ Gemini åŠŸèƒ½                            â”‚  â”‚
â”‚  â”‚  2. æ£€æŸ¥æ˜¯å¦å·²ç»‘å®š Google è´¦å·                        â”‚  â”‚
â”‚  â”‚  3. æœªç»‘å®š â†’ æç¤ºç»‘å®š                                 â”‚  â”‚
â”‚  â”‚  4. Google OAuth æµç¨‹                                 â”‚  â”‚
â”‚  â”‚  5. ç»‘å®šåˆ°æœåŠ¡ç«¯è´¦å·                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœåŠ¡ç«¯ API                              â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              è®¤è¯ API                                 â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  POST /auth/register      - æ³¨å†Œæ–°ç”¨æˆ·                â”‚  â”‚
â”‚  â”‚  POST /auth/login         - ç™»å½•                      â”‚  â”‚
â”‚  â”‚  POST /auth/verify-token  - éªŒè¯ Token                â”‚  â”‚
â”‚  â”‚  POST /auth/refresh-token - åˆ·æ–° Token                â”‚  â”‚
â”‚  â”‚  POST /auth/logout        - ç™»å‡º                      â”‚  â”‚
â”‚  â”‚  POST /auth/reset-password - é‡ç½®å¯†ç                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ç”¨æˆ· API                                 â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  GET  /user/profile       - è·å–ç”¨æˆ·ä¿¡æ¯              â”‚  â”‚
â”‚  â”‚  PUT  /user/profile       - æ›´æ–°ç”¨æˆ·ä¿¡æ¯              â”‚  â”‚
â”‚  â”‚  GET  /user/subscription  - è·å–è®¢é˜…çŠ¶æ€              â”‚  â”‚
â”‚  â”‚  POST /user/bind-google   - ç»‘å®š Google è´¦å·          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ä¸šåŠ¡ API                                 â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  GET  /conversations      - è·å–å¯¹è¯åˆ—è¡¨              â”‚  â”‚
â”‚  â”‚  POST /conversations      - åˆ›å»ºå¯¹è¯                  â”‚  â”‚
â”‚  â”‚  GET  /conversations/:id  - è·å–å¯¹è¯è¯¦æƒ…              â”‚  â”‚
â”‚  â”‚  PUT  /conversations/:id  - æ›´æ–°å¯¹è¯                  â”‚  â”‚
â”‚  â”‚  DELETE /conversations/:id - åˆ é™¤å¯¹è¯                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              æ•°æ®åº“                                   â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  - users (ç”¨æˆ·è¡¨)                                     â”‚  â”‚
â”‚  â”‚  - subscriptions (è®¢é˜…è¡¨)                             â”‚  â”‚
â”‚  â”‚  - google_bindings (Google ç»‘å®šè¡¨)                    â”‚  â”‚
â”‚  â”‚  - conversations (å¯¹è¯è¡¨)                             â”‚  â”‚
â”‚  â”‚  - messages (æ¶ˆæ¯è¡¨)                                  â”‚  â”‚
â”‚  â”‚  - usage_logs (ä½¿ç”¨æ—¥å¿—è¡¨)                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç™»å½•æµç¨‹

### æµç¨‹ 1: é¦–æ¬¡å¯åŠ¨ï¼ˆæœªç™»å½•ï¼‰

```mermaid
sequenceDiagram
    participant App as åº”ç”¨å¯åŠ¨
    participant Storage as æœ¬åœ°å­˜å‚¨
    participant LoginWin as ç™»å½•çª—å£
    participant Server as æœåŠ¡ç«¯
    participant MainWin as ä¸»çª—å£

    App->>Storage: è¯»å– Token
    Storage-->>App: Token ä¸å­˜åœ¨
    App->>LoginWin: æ˜¾ç¤ºç™»å½•çª—å£

    LoginWin->>Server: POST /auth/login
    Server->>Server: éªŒè¯è´¦å·å¯†ç 
    Server-->>LoginWin: è¿”å› Token + ç”¨æˆ·ä¿¡æ¯

    LoginWin->>Storage: ä¿å­˜ Token
    LoginWin->>MainWin: å…³é—­ç™»å½•çª—å£ï¼Œæ‰“å¼€ä¸»çª—å£
```

### æµç¨‹ 2: å†æ¬¡å¯åŠ¨ï¼ˆå·²ç™»å½•ï¼‰

```mermaid
sequenceDiagram
    participant App as åº”ç”¨å¯åŠ¨
    participant Storage as æœ¬åœ°å­˜å‚¨
    participant Server as æœåŠ¡ç«¯
    participant MainWin as ä¸»çª—å£
    participant LoginWin as ç™»å½•çª—å£

    App->>Storage: è¯»å– Token
    Storage-->>App: Token å­˜åœ¨
    App->>Server: POST /auth/verify-token

    alt Token æœ‰æ•ˆ
        Server-->>App: Token æœ‰æ•ˆ
        App->>MainWin: ç›´æ¥æ‰“å¼€ä¸»çª—å£
    else Token è¿‡æœŸ
        Server-->>App: Token è¿‡æœŸ
        App->>LoginWin: æ˜¾ç¤ºç™»å½•çª—å£
    end
```

### æµç¨‹ 3: ä½¿ç”¨ Gemini åŠŸèƒ½ï¼ˆéœ€è¦ Google è´¦å·ï¼‰

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant App as åº”ç”¨
    participant Server as æœåŠ¡ç«¯
    participant Google as Google OAuth

    User->>App: åˆ›å»º Gemini å¯¹è¯
    App->>App: æ£€æŸ¥æ˜¯å¦å·²ç»‘å®š Google

    alt æœªç»‘å®š
        App->>User: æç¤ºéœ€è¦ç»‘å®š Google è´¦å·
        User->>App: ç‚¹å‡»ç»‘å®š
        App->>Google: æ‰“å¼€ Google OAuth
        Google-->>App: è¿”å› Google Token
        App->>Server: POST /user/bind-google
        Server->>Server: ä¿å­˜ç»‘å®šå…³ç³»
        Server-->>App: ç»‘å®šæˆåŠŸ
        App->>User: ç»§ç»­åˆ›å»ºå¯¹è¯
    else å·²ç»‘å®š
        App->>User: ç›´æ¥åˆ›å»ºå¯¹è¯
    end
```

---

## å®¢æˆ·ç«¯å®ç°

### æ­¥éª¤ 1: åˆ›å»ºç™»å½•çª—å£

**æ–‡ä»¶**: `src/main/windows/loginWindow.ts` (æ–°å»º)

```typescript
/**
 * @license
 * Copyright 2025 AionUi (aionui.com)
 * SPDX-License-Identifier: Apache-2.0
 */

import { BrowserWindow } from 'electron';
import * as path from 'path';

let loginWindow: BrowserWindow | null = null;

export function createLoginWindow(): BrowserWindow {
  if (loginWindow) {
    loginWindow.focus();
    return loginWindow;
  }

  loginWindow = new BrowserWindow({
    width: 450,
    height: 650,
    resizable: false,
    center: true,
    frame: false, // æ— è¾¹æ¡†çª—å£
    transparent: false,
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, '../preload/index.js'),
    },
  });

  // å¼€å‘ç¯å¢ƒ
  if (process.env.NODE_ENV === 'development') {
    loginWindow.loadURL('http://localhost:3000/login');
    loginWindow.webContents.openDevTools();
  } else {
    // ç”Ÿäº§ç¯å¢ƒ
    loginWindow.loadFile(path.join(__dirname, '../renderer/login.html'));
  }

  loginWindow.on('closed', () => {
    loginWindow = null;
  });

  return loginWindow;
}

export function closeLoginWindow(): void {
  if (loginWindow) {
    loginWindow.close();
    loginWindow = null;
  }
}

export function getLoginWindow(): BrowserWindow | null {
  return loginWindow;
}
```

### æ­¥éª¤ 2: ä¿®æ”¹åº”ç”¨å¯åŠ¨é€»è¾‘

**æ–‡ä»¶**: `src/main/index.ts`

```typescript
import { app, BrowserWindow } from 'electron';
import { createLoginWindow, closeLoginWindow } from './windows/loginWindow';
import { createMainWindow } from './windows/mainWindow';
import { ipcBridge } from '../common';

let mainWindow: BrowserWindow | null = null;

async function checkLoginStatus(): Promise<boolean> {
  try {
    // è¯»å–æœ¬åœ°å­˜å‚¨çš„ Token
    const token = await ipcBridge.config.get('server.token');

    if (!token) {
      console.log('[Auth] No token found, need login');
      return false;
    }

    // éªŒè¯ Token æ˜¯å¦æœ‰æ•ˆ
    const response = await fetch('https://your-api.com/auth/verify-token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
    });

    const result = await response.json();

    if (result.success) {
      console.log('[Auth] Token valid, user:', result.user.email);
      return true;
    } else {
      console.log('[Auth] Token invalid:', result.message);
      // æ¸…é™¤æ— æ•ˆ Token
      await ipcBridge.config.delete('server.token');
      return false;
    }
  } catch (error) {
    console.error('[Auth] Error checking login status:', error);
    return false;
  }
}

app.on('ready', async () => {
  // åˆå§‹åŒ– IPC Bridge
  initBridge();

  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  const isLoggedIn = await checkLoginStatus();

  if (isLoggedIn) {
    // å·²ç™»å½•ï¼Œç›´æ¥æ‰“å¼€ä¸»çª—å£
    mainWindow = createMainWindow();
  } else {
    // æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•çª—å£
    createLoginWindow();
  }
});

// ç›‘å¬ç™»å½•æˆåŠŸäº‹ä»¶
ipcBridge.auth.onLoginSuccess.subscribe(() => {
  // å…³é—­ç™»å½•çª—å£
  closeLoginWindow();

  // æ‰“å¼€ä¸»çª—å£
  if (!mainWindow) {
    mainWindow = createMainWindow();
  }
});

// ç›‘å¬ç™»å‡ºäº‹ä»¶
ipcBridge.auth.onLogout.subscribe(() => {
  // å…³é—­ä¸»çª—å£
  if (mainWindow) {
    mainWindow.close();
    mainWindow = null;
  }

  // æ˜¾ç¤ºç™»å½•çª—å£
  createLoginWindow();
});

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});
```

### æ­¥éª¤ 3: æ·»åŠ è®¤è¯ IPC Bridge

**æ–‡ä»¶**: `src/common/ipcBridge.ts`

```typescript
// æ·»åŠ è®¤è¯ç›¸å…³çš„ IPC æ¥å£
export const ipcBridge = {
  // ... ç°æœ‰ä»£ç 

  auth: {
    // ç™»å½•
    login: createIpcBridge<{ email: string; password: string }, { success: boolean; token?: string; user?: any; message?: string }>('auth:login'),

    // æ³¨å†Œ
    register: createIpcBridge<{ email: string; password: string; name: string }, { success: boolean; message?: string }>('auth:register'),

    // éªŒè¯ Token
    verifyToken: createIpcBridge<{ token: string }, { success: boolean; user?: any; message?: string }>('auth:verify-token'),

    // ç™»å‡º
    logout: createIpcBridge<void, { success: boolean }>('auth:logout'),

    // é‡ç½®å¯†ç 
    resetPassword: createIpcBridge<{ email: string }, { success: boolean; message?: string }>('auth:reset-password'),

    // å‘é€éªŒè¯ç 
    sendVerificationCode: createIpcBridge<{ phone: string }, { success: boolean; message?: string }>('auth:send-code'),

    // éªŒè¯ç ç™»å½•
    loginWithCode: createIpcBridge<{ phone: string; code: string }, { success: boolean; token?: string; user?: any; message?: string }>('auth:login-code'),

    // äº‹ä»¶ï¼šç™»å½•æˆåŠŸ
    onLoginSuccess: createEventEmitter<{ user: any }>('auth:login-success'),

    // äº‹ä»¶ï¼šç™»å‡º
    onLogout: createEventEmitter<void>('auth:logout'),
  },
};
```

### æ­¥éª¤ 4: å®ç°è®¤è¯ Bridge å¤„ç†å™¨

**æ–‡ä»¶**: `src/process/bridge/authBridge.ts`

```typescript
/**
 * @license
 * Copyright 2025 AionUi (aionui.com)
 * SPDX-License-Identifier: Apache-2.0
 */

import { ipcBridge } from '../../common';

const API_BASE_URL = process.env.SERVER_API_URL || 'https://your-api.com';

export function initAuthBridge(): void {
  // ç™»å½•å¤„ç†å™¨
  ipcBridge.auth.login.provider(async ({ email, password }) => {
    try {
      const response = await fetch(`${API_BASE_URL}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });

      const result = await response.json();

      if (result.success && result.token) {
        // ä¿å­˜ Token å’Œç”¨æˆ·ä¿¡æ¯
        await ipcBridge.config.set('server.token', result.token);
        await ipcBridge.config.set('server.user', JSON.stringify(result.user));

        // è§¦å‘ç™»å½•æˆåŠŸäº‹ä»¶
        ipcBridge.auth.onLoginSuccess.emit({ user: result.user });

        return {
          success: true,
          token: result.token,
          user: result.user,
        };
      } else {
        return {
          success: false,
          message: result.message || 'ç™»å½•å¤±è´¥',
        };
      }
    } catch (error) {
      console.error('[Auth] Login error:', error);
      return {
        success: false,
        message: error.message || 'ç½‘ç»œé”™è¯¯',
      };
    }
  });

  // æ³¨å†Œå¤„ç†å™¨
  ipcBridge.auth.register.provider(async ({ email, password, name }) => {
    try {
      const response = await fetch(`${API_BASE_URL}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password, name }),
      });

      const result = await response.json();

      return {
        success: result.success,
        message: result.message,
      };
    } catch (error) {
      return {
        success: false,
        message: error.message || 'æ³¨å†Œå¤±è´¥',
      };
    }
  });

  // éªŒè¯ Token å¤„ç†å™¨
  ipcBridge.auth.verifyToken.provider(async ({ token }) => {
    try {
      const response = await fetch(`${API_BASE_URL}/auth/verify-token`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`,
        },
      });

      const result = await response.json();

      return {
        success: result.success,
        user: result.user,
        message: result.message,
      };
    } catch (error) {
      return {
        success: false,
        message: error.message || 'éªŒè¯å¤±è´¥',
      };
    }
  });

  // ç™»å‡ºå¤„ç†å™¨
  ipcBridge.auth.logout.provider(async () => {
    try {
      // æ¸…é™¤æœ¬åœ°å­˜å‚¨
      await ipcBridge.config.delete('server.token');
      await ipcBridge.config.delete('server.user');
      await ipcBridge.config.delete('server.googleBinding');

      // è§¦å‘ç™»å‡ºäº‹ä»¶
      ipcBridge.auth.onLogout.emit();

      return { success: true };
    } catch (error) {
      return { success: false };
    }
  });

  // é‡ç½®å¯†ç å¤„ç†å™¨
  ipcBridge.auth.resetPassword.provider(async ({ email }) => {
    try {
      const response = await fetch(`${API_BASE_URL}/auth/reset-password`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
      });

      const result = await response.json();

      return {
        success: result.success,
        message: result.message,
      };
    } catch (error) {
      return {
        success: false,
        message: error.message || 'å‘é€å¤±è´¥',
      };
    }
  });

  // å‘é€éªŒè¯ç å¤„ç†å™¨
  ipcBridge.auth.sendVerificationCode.provider(async ({ phone }) => {
    try {
      const response = await fetch(`${API_BASE_URL}/auth/send-code`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone }),
      });

      const result = await response.json();

      return {
        success: result.success,
        message: result.message,
      };
    } catch (error) {
      return {
        success: false,
        message: error.message || 'å‘é€å¤±è´¥',
      };
    }
  });

  // éªŒè¯ç ç™»å½•å¤„ç†å™¨
  ipcBridge.auth.loginWithCode.provider(async ({ phone, code }) => {
    try {
      const response = await fetch(`${API_BASE_URL}/auth/login-code`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone, code }),
      });

      const result = await response.json();

      if (result.success && result.token) {
        // ä¿å­˜ Token å’Œç”¨æˆ·ä¿¡æ¯
        await ipcBridge.config.set('server.token', result.token);
        await ipcBridge.config.set('server.user', JSON.stringify(result.user));

        // è§¦å‘ç™»å½•æˆåŠŸäº‹ä»¶
        ipcBridge.auth.onLoginSuccess.emit({ user: result.user });

        return {
          success: true,
          token: result.token,
          user: result.user,
        };
      } else {
        return {
          success: false,
          message: result.message || 'ç™»å½•å¤±è´¥',
        };
      }
    } catch (error) {
      return {
        success: false,
        message: error.message || 'ç½‘ç»œé”™è¯¯',
      };
    }
  });
}
```

### æ­¥éª¤ 5: åˆ›å»ºç™»å½•ç•Œé¢

**æ–‡ä»¶**: `src/renderer/pages/Login.tsx` (æ–°å»º)

```tsx
import React, { useState } from 'react';
import { Form, Input, Button, Tabs, Message } from '@arco-design/web-react';
import { IconUser, IconLock, IconPhone, IconMail } from '@arco-design/web-react/icon';
import { ipcBridge } from '@/common';
import './Login.css';

const FormItem = Form.Item;
const TabPane = Tabs.TabPane;

export function LoginPage() {
  const [loading, setLoading] = useState(false);
  const [activeTab, setActiveTab] = useState('password');

  // è´¦å·å¯†ç ç™»å½•
  const handlePasswordLogin = async (values: any) => {
    setLoading(true);
    try {
      const result = await ipcBridge.auth.login.invoke({
        email: values.email,
        password: values.password,
      });

      if (result.success) {
        Message.success('ç™»å½•æˆåŠŸ');
        // ç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨è§¦å‘çª—å£åˆ‡æ¢
      } else {
        Message.error(result.message || 'ç™»å½•å¤±è´¥');
      }
    } catch (error) {
      Message.error('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  // éªŒè¯ç ç™»å½•
  const handleCodeLogin = async (values: any) => {
    setLoading(true);
    try {
      const result = await ipcBridge.auth.loginWithCode.invoke({
        phone: values.phone,
        code: values.code,
      });

      if (result.success) {
        Message.success('ç™»å½•æˆåŠŸ');
      } else {
        Message.error(result.message || 'ç™»å½•å¤±è´¥');
      }
    } catch (error) {
      Message.error('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  // å‘é€éªŒè¯ç 
  const [countdown, setCountdown] = useState(0);
  const handleSendCode = async (phone: string) => {
    if (!phone) {
      Message.warning('è¯·è¾“å…¥æ‰‹æœºå·');
      return;
    }

    try {
      const result = await ipcBridge.auth.sendVerificationCode.invoke({ phone });

      if (result.success) {
        Message.success('éªŒè¯ç å·²å‘é€');
        setCountdown(60);

        // å€’è®¡æ—¶
        const timer = setInterval(() => {
          setCountdown((prev) => {
            if (prev <= 1) {
              clearInterval(timer);
              return 0;
            }
            return prev - 1;
          });
        }, 1000);
      } else {
        Message.error(result.message || 'å‘é€å¤±è´¥');
      }
    } catch (error) {
      Message.error('å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  };

  return (
    <div className='login-container'>
      <div className='login-box'>
        <div className='login-header'>
          <img src='/logo.png' alt='AionUi' className='logo' />
          <h1>AionUi</h1>
          <p>AI åŠ©æ‰‹æ¡Œé¢åº”ç”¨</p>
        </div>

        <Tabs activeTab={activeTab} onChange={setActiveTab}>
          {/* è´¦å·å¯†ç ç™»å½• */}
          <TabPane key='password' title='è´¦å·ç™»å½•'>
            <Form onSubmit={handlePasswordLogin} autoComplete='off'>
              <FormItem field='email' rules={[{ required: true, message: 'è¯·è¾“å…¥é‚®ç®±' }]}>
                <Input prefix={<IconMail />} placeholder='é‚®ç®±' size='large' />
              </FormItem>

              <FormItem field='password' rules={[{ required: true, message: 'è¯·è¾“å…¥å¯†ç ' }]}>
                <Input.Password prefix={<IconLock />} placeholder='å¯†ç ' size='large' />
              </FormItem>

              <FormItem>
                <Button type='primary' htmlType='submit' long size='large' loading={loading}>
                  ç™»å½•
                </Button>
              </FormItem>

              <div className='login-links'>
                <a href='#' onClick={() => setActiveTab('register')}>
                  æ³¨å†Œè´¦å·
                </a>
                <a href='#' onClick={() => setActiveTab('reset')}>
                  å¿˜è®°å¯†ç 
                </a>
              </div>
            </Form>
          </TabPane>

          {/* éªŒè¯ç ç™»å½• */}
          <TabPane key='code' title='éªŒè¯ç ç™»å½•'>
            <Form onSubmit={handleCodeLogin} autoComplete='off'>
              <FormItem field='phone' rules={[{ required: true, message: 'è¯·è¾“å…¥æ‰‹æœºå·' }]}>
                <Input prefix={<IconPhone />} placeholder='æ‰‹æœºå·' size='large' />
              </FormItem>

              <FormItem field='code' rules={[{ required: true, message: 'è¯·è¾“å…¥éªŒè¯ç ' }]}>
                <Input
                  placeholder='éªŒè¯ç '
                  size='large'
                  suffix={
                    <Button
                      type='text'
                      size='small'
                      disabled={countdown > 0}
                      onClick={(e) => {
                        const form = (e.target as any).closest('form');
                        const phone = form?.phone?.value;
                        handleSendCode(phone);
                      }}
                    >
                      {countdown > 0 ? `${countdown}ç§’åé‡è¯•` : 'å‘é€éªŒè¯ç '}
                    </Button>
                  }
                />
              </FormItem>

              <FormItem>
                <Button type='primary' htmlType='submit' long size='large' loading={loading}>
                  ç™»å½•
                </Button>
              </FormItem>
            </Form>
          </TabPane>

          {/* æ³¨å†Œ */}
          <TabPane key='register' title='æ³¨å†Œ'>
            <RegisterForm onSuccess={() => setActiveTab('password')} />
          </TabPane>

          {/* é‡ç½®å¯†ç  */}
          <TabPane key='reset' title='é‡ç½®å¯†ç '>
            <ResetPasswordForm onSuccess={() => setActiveTab('password')} />
          </TabPane>
        </Tabs>
      </div>
    </div>
  );
}

// æ³¨å†Œè¡¨å•ç»„ä»¶
function RegisterForm({ onSuccess }: { onSuccess: () => void }) {
  const [loading, setLoading] = useState(false);

  const handleRegister = async (values: any) => {
    setLoading(true);
    try {
      const result = await ipcBridge.auth.register.invoke({
        email: values.email,
        password: values.password,
        name: values.name,
      });

      if (result.success) {
        Message.success('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
        onSuccess();
      } else {
        Message.error(result.message || 'æ³¨å†Œå¤±è´¥');
      }
    } catch (error) {
      Message.error('æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  return (
    <Form onSubmit={handleRegister} autoComplete='off'>
      <FormItem field='name' rules={[{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å' }]}>
        <Input prefix={<IconUser />} placeholder='ç”¨æˆ·å' size='large' />
      </FormItem>

      <FormItem field='email' rules={[{ required: true, type: 'email', message: 'è¯·è¾“å…¥æœ‰æ•ˆé‚®ç®±' }]}>
        <Input prefix={<IconMail />} placeholder='é‚®ç®±' size='large' />
      </FormItem>

      <FormItem field='password' rules={[{ required: true, minLength: 6, message: 'å¯†ç è‡³å°‘ 6 ä½' }]}>
        <Input.Password prefix={<IconLock />} placeholder='å¯†ç ' size='large' />
      </FormItem>

      <FormItem
        field='confirmPassword'
        rules={[
          { required: true, message: 'è¯·ç¡®è®¤å¯†ç ' },
          {
            validator: (value, callback) => {
              const form = callback as any;
              if (value !== form.getFieldValue('password')) {
                callback('ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´');
              } else {
                callback();
              }
            },
          },
        ]}
      >
        <Input.Password prefix={<IconLock />} placeholder='ç¡®è®¤å¯†ç ' size='large' />
      </FormItem>

      <FormItem>
        <Button type='primary' htmlType='submit' long size='large' loading={loading}>
          æ³¨å†Œ
        </Button>
      </FormItem>
    </Form>
  );
}

// é‡ç½®å¯†ç è¡¨å•ç»„ä»¶
function ResetPasswordForm({ onSuccess }: { onSuccess: () => void }) {
  const [loading, setLoading] = useState(false);

  const handleReset = async (values: any) => {
    setLoading(true);
    try {
      const result = await ipcBridge.auth.resetPassword.invoke({
        email: values.email,
      });

      if (result.success) {
        Message.success('é‡ç½®é“¾æ¥å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±');
        onSuccess();
      } else {
        Message.error(result.message || 'å‘é€å¤±è´¥');
      }
    } catch (error) {
      Message.error('å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  return (
    <Form onSubmit={handleReset} autoComplete='off'>
      <FormItem field='email' rules={[{ required: true, type: 'email', message: 'è¯·è¾“å…¥æœ‰æ•ˆé‚®ç®±' }]}>
        <Input prefix={<IconMail />} placeholder='æ³¨å†Œé‚®ç®±' size='large' />
      </FormItem>

      <FormItem>
        <Button type='primary' htmlType='submit' long size='large' loading={loading}>
          å‘é€é‡ç½®é“¾æ¥
        </Button>
      </FormItem>
    </Form>
  );
}
```

**æ ·å¼æ–‡ä»¶**: `src/renderer/pages/Login.css`

```css
.login-container {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-box {
  width: 400px;
  padding: 40px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.login-header {
  text-align: center;
  margin-bottom: 30px;
}

.login-header .logo {
  width: 64px;
  height: 64px;
  margin-bottom: 16px;
}

.login-header h1 {
  font-size: 28px;
  font-weight: 600;
  margin: 0 0 8px 0;
  color: #1d2129;
}

.login-header p {
  font-size: 14px;
  color: #86909c;
  margin: 0;
}

.login-links {
  display: flex;
  justify-content: space-between;
  margin-top: 16px;
}

.login-links a {
  font-size: 14px;
  color: #165dff;
  text-decoration: none;
}

.login-links a:hover {
  text-decoration: underline;
}
```

---

## æœåŠ¡ç«¯ API

### API 1: ç”¨æˆ·æ³¨å†Œ

**ç«¯ç‚¹**: `POST /auth/register`

**è¯·æ±‚**:

```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "User Name"
}
```

**å“åº”**:

```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "userId": "uuid-1234"
}
```

**å®ç°**:

```javascript
router.post('/register', async (req, res) => {
  try {
    const { email, password, name } = req.body;

    // éªŒè¯å¿…å¡«å­—æ®µ
    if (!email || !password || !name) {
      return res.status(400).json({
        success: false,
        message: 'ç¼ºå°‘å¿…å¡«å­—æ®µ',
      });
    }

    // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
    const existing = await User.findOne({ email });
    if (existing) {
      return res.status(400).json({
        success: false,
        message: 'è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ',
      });
    }

    // å¯†ç åŠ å¯†
    const bcrypt = require('bcrypt');
    const hashedPassword = await bcrypt.hash(password, 10);

    // åˆ›å»ºç”¨æˆ·
    const user = new User({
      id: uuidv4(),
      email,
      password: hashedPassword,
      name,
      subscription: 'free', // é»˜è®¤å…è´¹ç‰ˆ
      createdAt: new Date(),
    });

    await user.save();

    res.json({
      success: true,
      message: 'æ³¨å†ŒæˆåŠŸ',
      userId: user.id,
    });
  } catch (error) {
    console.error('[Auth] Register error:', error);
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯',
    });
  }
});
```

### API 2: ç”¨æˆ·ç™»å½•

**ç«¯ç‚¹**: `POST /auth/login`

**è¯·æ±‚**:

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**å“åº”**:

```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "uuid-1234",
    "email": "user@example.com",
    "name": "User Name",
    "avatar": "https://...",
    "subscription": "pro",
    "createdAt": "2026-01-29T10:00:00Z"
  }
}
```

**å®ç°**:

```javascript
router.post('/login', async (req, res) => {
  try {
    const { email, password } = req.body;

    // æŸ¥æ‰¾ç”¨æˆ·
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(401).json({
        success: false,
        message: 'é‚®ç®±æˆ–å¯†ç é”™è¯¯',
      });
    }

    // éªŒè¯å¯†ç 
    const bcrypt = require('bcrypt');
    const isValid = await bcrypt.compare(password, user.password);
    if (!isValid) {
      return res.status(401).json({
        success: false,
        message: 'é‚®ç®±æˆ–å¯†ç é”™è¯¯',
      });
    }

    // æ›´æ–°æœ€åç™»å½•æ—¶é—´
    user.lastLogin = new Date();
    await user.save();

    // ç”Ÿæˆ JWT Token
    const jwt = require('jsonwebtoken');
    const token = jwt.sign(
      {
        userId: user.id,
        email: user.email,
      },
      process.env.JWT_SECRET,
      { expiresIn: '30d' }
    );

    res.json({
      success: true,
      token,
      user: {
        id: user.id,
        email: user.email,
        name: user.name,
        avatar: user.avatar,
        subscription: user.subscription,
        createdAt: user.createdAt,
      },
    });
  } catch (error) {
    console.error('[Auth] Login error:', error);
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯',
    });
  }
});
```

### API 3: éªŒè¯ Token

**ç«¯ç‚¹**: `POST /auth/verify-token`

**è¯·æ±‚å¤´**:

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**å“åº”**:

```json
{
  "success": true,
  "user": {
    "id": "uuid-1234",
    "email": "user@example.com",
    "name": "User Name"
  }
}
```

**å®ç°**:

```javascript
router.post('/verify-token', authenticateToken, async (req, res) => {
  try {
    // authenticateToken ä¸­é—´ä»¶å·²éªŒè¯ Token
    const userId = req.user.userId;

    // è·å–ç”¨æˆ·ä¿¡æ¯
    const user = await User.findOne({ id: userId });
    if (!user) {
      return res.status(404).json({
        success: false,
        message: 'ç”¨æˆ·ä¸å­˜åœ¨',
      });
    }

    res.json({
      success: true,
      user: {
        id: user.id,
        email: user.email,
        name: user.name,
        avatar: user.avatar,
        subscription: user.subscription,
      },
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯',
    });
  }
});
```

### API 4: å‘é€éªŒè¯ç 

**ç«¯ç‚¹**: `POST /auth/send-code`

**è¯·æ±‚**:

```json
{
  "phone": "13800138000"
}
```

**å“åº”**:

```json
{
  "success": true,
  "message": "éªŒè¯ç å·²å‘é€"
}
```

**å®ç°**:

```javascript
// ä½¿ç”¨é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡æˆ–å…¶ä»–çŸ­ä¿¡å¹³å°
const SMSClient = require('@alicloud/sms-sdk');

router.post('/send-code', async (req, res) => {
  try {
    const { phone } = req.body;

    // éªŒè¯æ‰‹æœºå·æ ¼å¼
    if (!/^1[3-9]\d{9}$/.test(phone)) {
      return res.status(400).json({
        success: false,
        message: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®',
      });
    }

    // ç”Ÿæˆ 6 ä½éªŒè¯ç 
    const code = Math.floor(100000 + Math.random() * 900000).toString();

    // å­˜å‚¨éªŒè¯ç ï¼ˆRedisï¼Œ5 åˆ†é’Ÿè¿‡æœŸï¼‰
    await redis.setex(`sms:${phone}`, 300, code);

    // å‘é€çŸ­ä¿¡
    const smsClient = new SMSClient({
      accessKeyId: process.env.ALIYUN_ACCESS_KEY_ID,
      secretAccessKey: process.env.ALIYUN_ACCESS_KEY_SECRET,
    });

    await smsClient.sendSMS({
      PhoneNumbers: phone,
      SignName: 'AionUi',
      TemplateCode: 'SMS_123456789',
      TemplateParam: JSON.stringify({ code }),
    });

    res.json({
      success: true,
      message: 'éªŒè¯ç å·²å‘é€',
    });
  } catch (error) {
    console.error('[Auth] Send code error:', error);
    res.status(500).json({
      success: false,
      message: 'å‘é€å¤±è´¥',
    });
  }
});
```

### API 5: éªŒè¯ç ç™»å½•

**ç«¯ç‚¹**: `POST /auth/login-code`

**è¯·æ±‚**:

```json
{
  "phone": "13800138000",
  "code": "123456"
}
```

**å“åº”**:

```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": { ... }
}
```

**å®ç°**:

```javascript
router.post('/login-code', async (req, res) => {
  try {
    const { phone, code } = req.body;

    // éªŒè¯éªŒè¯ç 
    const storedCode = await redis.get(`sms:${phone}`);
    if (!storedCode || storedCode !== code) {
      return res.status(401).json({
        success: false,
        message: 'éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ',
      });
    }

    // æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
    let user = await User.findOne({ phone });
    if (!user) {
      user = new User({
        id: uuidv4(),
        phone,
        name: `ç”¨æˆ·${phone.slice(-4)}`,
        subscription: 'free',
        createdAt: new Date(),
      });
      await user.save();
    }

    // æ›´æ–°æœ€åç™»å½•æ—¶é—´
    user.lastLogin = new Date();
    await user.save();

    // åˆ é™¤éªŒè¯ç 
    await redis.del(`sms:${phone}`);

    // ç”Ÿæˆ Token
    const token = jwt.sign({ userId: user.id, phone: user.phone }, process.env.JWT_SECRET, { expiresIn: '30d' });

    res.json({
      success: true,
      token,
      user: {
        id: user.id,
        phone: user.phone,
        name: user.name,
        subscription: user.subscription,
      },
    });
  } catch (error) {
    console.error('[Auth] Login with code error:', error);
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯',
    });
  }
});
```

---

## æ•°æ®åº“è®¾è®¡

### ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
  id VARCHAR(36) PRIMARY KEY,
  email VARCHAR(255) UNIQUE,
  phone VARCHAR(20) UNIQUE,
  password VARCHAR(255),
  name VARCHAR(100) NOT NULL,
  avatar TEXT,
  subscription ENUM('free', 'pro', 'enterprise') DEFAULT 'free',
  subscription_expires_at TIMESTAMP NULL,
  google_id VARCHAR(255) UNIQUE,
  google_email VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_login TIMESTAMP NULL,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  is_active BOOLEAN DEFAULT TRUE,

  INDEX idx_email (email),
  INDEX idx_phone (phone),
  INDEX idx_google_id (google_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### è®¢é˜…è¡¨ (subscriptions)

```sql
CREATE TABLE subscriptions (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  plan ENUM('free', 'pro', 'enterprise') NOT NULL,
  status ENUM('active', 'expired', 'cancelled') DEFAULT 'active',
  started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NULL,
  auto_renew BOOLEAN DEFAULT FALSE,
  payment_method VARCHAR(50),

  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_user_id (user_id),
  INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### Google ç»‘å®šè¡¨ (google_bindings)

```sql
CREATE TABLE google_bindings (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  google_id VARCHAR(255) NOT NULL UNIQUE,
  google_email VARCHAR(255) NOT NULL,
  google_name VARCHAR(255),
  google_picture TEXT,
  bound_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_used_at TIMESTAMP NULL,

  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_user_id (user_id),
  INDEX idx_google_id (google_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### å¯¹è¯è¡¨ (conversations)

```sql
CREATE TABLE conversations (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  title VARCHAR(255) NOT NULL,
  type ENUM('gemini', 'claude', 'codex', 'qwen') NOT NULL,
  model VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP NULL,

  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_user_id (user_id),
  INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### æ¶ˆæ¯è¡¨ (messages)

```sql
CREATE TABLE messages (
  id VARCHAR(36) PRIMARY KEY,
  conversation_id VARCHAR(36) NOT NULL,
  role ENUM('user', 'assistant', 'system') NOT NULL,
  content TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE,
  INDEX idx_conversation_id (conversation_id),
  INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### ä½¿ç”¨æ—¥å¿—è¡¨ (usage_logs)

```sql
CREATE TABLE usage_logs (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  action VARCHAR(50) NOT NULL,
  resource_type VARCHAR(50),
  resource_id VARCHAR(36),
  metadata JSON,
  ip_address VARCHAR(45),
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_user_id (user_id),
  INDEX idx_action (action),
  INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

---

## æƒé™æ§åˆ¶

### è®¢é˜…ç­‰çº§åŠŸèƒ½å¯¹ç…§è¡¨

| åŠŸèƒ½            | Free | Pro  | Enterprise |
| --------------- | ---- | ---- | ---------- |
| åŸºç¡€å¯¹è¯        | âœ…   | âœ…   | âœ…         |
| Gemini æ¨¡å‹     | âŒ   | âœ…   | âœ…         |
| Claude æ¨¡å‹     | âŒ   | âœ…   | âœ…         |
| å¯¹è¯æ•°é‡é™åˆ¶    | 10   | æ— é™ | æ— é™       |
| æ¶ˆæ¯æ•°é‡é™åˆ¶/å¤© | 50   | 500  | æ— é™       |
| æ–‡ä»¶ä¸Šä¼         | âŒ   | âœ…   | âœ…         |
| å›¾åƒç”Ÿæˆ        | âŒ   | âœ…   | âœ…         |
| æŠ€èƒ½ç³»ç»Ÿ        | âŒ   | âœ…   | âœ…         |
| MCP æœåŠ¡å™¨      | âŒ   | âœ…   | âœ…         |
| æ•°æ®åŒæ­¥        | âŒ   | âœ…   | âœ…         |
| ä¼˜å…ˆæ”¯æŒ        | âŒ   | âŒ   | âœ…         |
| API è®¿é—®        | âŒ   | âŒ   | âœ…         |

### æƒé™æ£€æŸ¥ä¸­é—´ä»¶

```javascript
// middleware/subscription.js

/**
 * æ£€æŸ¥ç”¨æˆ·è®¢é˜…ç­‰çº§
 */
function requireSubscription(minLevel) {
  const levels = { free: 0, pro: 1, enterprise: 2 };

  return async (req, res, next) => {
    try {
      const userId = req.user.userId;
      const user = await User.findOne({ id: userId });

      if (!user) {
        return res.status(404).json({
          success: false,
          message: 'ç”¨æˆ·ä¸å­˜åœ¨',
        });
      }

      // æ£€æŸ¥è®¢é˜…æ˜¯å¦è¿‡æœŸ
      if (user.subscription_expires_at && new Date() > user.subscription_expires_at) {
        user.subscription = 'free';
        await user.save();
      }

      // æ£€æŸ¥ç­‰çº§
      const userLevel = levels[user.subscription] || 0;
      const requiredLevel = levels[minLevel] || 0;

      if (userLevel < requiredLevel) {
        return res.status(403).json({
          success: false,
          message: `æ­¤åŠŸèƒ½éœ€è¦ ${minLevel} è®¢é˜…`,
          code: 'SUBSCRIPTION_REQUIRED',
          requiredSubscription: minLevel,
          currentSubscription: user.subscription,
        });
      }

      req.user.subscription = user.subscription;
      next();
    } catch (error) {
      res.status(500).json({
        success: false,
        message: 'æœåŠ¡å™¨é”™è¯¯',
      });
    }
  };
}

module.exports = { requireSubscription };
```

### ä½¿ç”¨æƒé™ä¸­é—´ä»¶

```javascript
const { authenticateToken } = require('../middleware/auth');
const { requireSubscription } = require('../middleware/subscription');

// åˆ›å»º Gemini å¯¹è¯ï¼ˆéœ€è¦ Pro è®¢é˜…ï¼‰
router.post('/conversations/gemini', authenticateToken, requireSubscription('pro'), async (req, res) => {
  // åˆ›å»ºå¯¹è¯é€»è¾‘...
});

// å›¾åƒç”Ÿæˆï¼ˆéœ€è¦ Pro è®¢é˜…ï¼‰
router.post('/images/generate', authenticateToken, requireSubscription('pro'), async (req, res) => {
  // å›¾åƒç”Ÿæˆé€»è¾‘...
});

// API è®¿é—®ï¼ˆéœ€è¦ Enterprise è®¢é˜…ï¼‰
router.get('/api/data', authenticateToken, requireSubscription('enterprise'), async (req, res) => {
  // API é€»è¾‘...
});
```

### å®¢æˆ·ç«¯æƒé™æ£€æŸ¥

```typescript
// src/utils/subscription.ts

export async function checkFeatureAccess(feature: string): Promise<boolean> {
  const user = await ipcBridge.serverAuth.getUser.invoke();

  if (!user) return false;

  const featureRequirements: Record<string, string[]> = {
    gemini: ['pro', 'enterprise'],
    claude: ['pro', 'enterprise'],
    'image-generation': ['pro', 'enterprise'],
    skills: ['pro', 'enterprise'],
    mcp: ['pro', 'enterprise'],
    api: ['enterprise'],
  };

  const required = featureRequirements[feature] || [];
  return required.includes(user.subscription);
}

// ä½¿ç”¨ç¤ºä¾‹
async function createGeminiConversation() {
  const hasAccess = await checkFeatureAccess('gemini');

  if (!hasAccess) {
    Message.warning('æ­¤åŠŸèƒ½éœ€è¦ Pro è®¢é˜…');
    // æ˜¾ç¤ºå‡çº§æç¤º
    showUpgradeModal();
    return;
  }

  // ç»§ç»­åˆ›å»ºå¯¹è¯...
}
```

---

## Google è´¦å·ç»‘å®š

### ç»‘å®šæµç¨‹

ç”¨æˆ·åœ¨ä½¿ç”¨ Gemini åŠŸèƒ½æ—¶ï¼Œå¦‚æœæœªç»‘å®š Google è´¦å·ï¼Œä¼šæç¤ºç»‘å®šï¼š

```typescript
// src/renderer/hooks/useGeminiAccess.ts

export function useGeminiAccess() {
  const [hasGoogleBinding, setHasGoogleBinding] = useState(false);

  useEffect(() => {
    checkGoogleBinding();
  }, []);

  const checkGoogleBinding = async () => {
    const binding = await ipcBridge.config.get('server.googleBinding');
    setHasGoogleBinding(!!binding);
  };

  const bindGoogle = async () => {
    try {
      // 1. Google OAuth ç™»å½•
      const googleResult = await ipcBridge.googleAuth.login.invoke({});

      if (!googleResult.success) {
        Message.error('Google ç™»å½•å¤±è´¥');
        return false;
      }

      // 2. è·å– Google ä¿¡æ¯
      const googleInfo = await getOauthInfoWithCache();

      // 3. è°ƒç”¨æœåŠ¡ç«¯ç»‘å®š API
      const token = await ipcBridge.serverAuth.getToken.invoke();
      const response = await fetch('https://your-api.com/user/bind-google', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({
          googleId: googleInfo.sub,
          googleEmail: googleInfo.email,
          googleName: googleInfo.name,
          googlePicture: googleInfo.picture,
        }),
      });

      const result = await response.json();

      if (result.success) {
        // 4. ä¿å­˜ç»‘å®šä¿¡æ¯
        await ipcBridge.config.set(
          'server.googleBinding',
          JSON.stringify({
            googleId: googleInfo.sub,
            googleEmail: googleInfo.email,
            boundAt: new Date().toISOString(),
          })
        );

        setHasGoogleBinding(true);
        Message.success('Google è´¦å·ç»‘å®šæˆåŠŸ');
        return true;
      } else {
        Message.error(result.message || 'ç»‘å®šå¤±è´¥');
        return false;
      }
    } catch (error) {
      Message.error('ç»‘å®šå¤±è´¥ï¼Œè¯·é‡è¯•');
      return false;
    }
  };

  return { hasGoogleBinding, bindGoogle };
}
```

### æœåŠ¡ç«¯ç»‘å®š API

```javascript
// POST /user/bind-google
router.post('/bind-google', authenticateToken, async (req, res) => {
  try {
    const userId = req.user.userId;
    const { googleId, googleEmail, googleName, googlePicture } = req.body;

    // æ£€æŸ¥ Google ID æ˜¯å¦å·²è¢«å…¶ä»–ç”¨æˆ·ç»‘å®š
    const existingBinding = await GoogleBinding.findOne({ googleId });
    if (existingBinding && existingBinding.userId !== userId) {
      return res.status(400).json({
        success: false,
        message: 'è¯¥ Google è´¦å·å·²è¢«å…¶ä»–ç”¨æˆ·ç»‘å®š',
      });
    }

    // åˆ›å»ºæˆ–æ›´æ–°ç»‘å®š
    if (existingBinding) {
      existingBinding.googleEmail = googleEmail;
      existingBinding.googleName = googleName;
      existingBinding.googlePicture = googlePicture;
      existingBinding.lastUsedAt = new Date();
      await existingBinding.save();
    } else {
      const binding = new GoogleBinding({
        id: uuidv4(),
        userId,
        googleId,
        googleEmail,
        googleName,
        googlePicture,
        boundAt: new Date(),
      });
      await binding.save();
    }

    // æ›´æ–°ç”¨æˆ·è¡¨
    await User.updateOne(
      { id: userId },
      {
        googleId,
        googleEmail,
      }
    );

    res.json({
      success: true,
      message: 'Google è´¦å·ç»‘å®šæˆåŠŸ',
    });
  } catch (error) {
    console.error('[User] Bind Google error:', error);
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯',
    });
  }
});
```

### ä½¿ç”¨ Gemini æ—¶çš„æ£€æŸ¥

```typescript
// src/renderer/pages/conversation/CreateConversation.tsx

function CreateGeminiConversation() {
  const { hasGoogleBinding, bindGoogle } = useGeminiAccess();

  const handleCreate = async () => {
    // æ£€æŸ¥è®¢é˜…
    const hasAccess = await checkFeatureAccess('gemini');
    if (!hasAccess) {
      showUpgradeModal();
      return;
    }

    // æ£€æŸ¥ Google ç»‘å®š
    if (!hasGoogleBinding) {
      Modal.confirm({
        title: 'éœ€è¦ç»‘å®š Google è´¦å·',
        content: 'ä½¿ç”¨ Gemini åŠŸèƒ½éœ€è¦ç»‘å®š Google è´¦å·ï¼Œæ˜¯å¦ç«‹å³ç»‘å®šï¼Ÿ',
        onOk: async () => {
          const success = await bindGoogle();
          if (success) {
            // ç»‘å®šæˆåŠŸï¼Œç»§ç»­åˆ›å»ºå¯¹è¯
            createConversation();
          }
        },
      });
      return;
    }

    // åˆ›å»ºå¯¹è¯
    createConversation();
  };

  return (
    <Button onClick={handleCreate}>
      åˆ›å»º Gemini å¯¹è¯
    </Button>
  );
}
```

---

## ç¦»çº¿æ¨¡å¼

### ç¦»çº¿åŠŸèƒ½æ”¯æŒ

å½“æœåŠ¡ç«¯ä¸å¯ç”¨æ—¶ï¼Œæä¾›é™çº§æ–¹æ¡ˆï¼š

```typescript
// src/main/index.ts

let offlineMode = false;

async function checkServerAvailability(): Promise<boolean> {
  try {
    const response = await fetch('https://your-api.com/health', {
      timeout: 5000,
    });
    return response.ok;
  } catch {
    return false;
  }
}

app.on('ready', async () => {
  const serverAvailable = await checkServerAvailability();

  if (!serverAvailable) {
    // æœåŠ¡ç«¯ä¸å¯ç”¨
    offlineMode = true;

    // æ˜¾ç¤ºç¦»çº¿æ¨¡å¼æç¤º
    dialog.showMessageBox({
      type: 'warning',
      title: 'ç¦»çº¿æ¨¡å¼',
      message: 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå°†ä»¥ç¦»çº¿æ¨¡å¼è¿è¡Œ',
      detail: 'éƒ¨åˆ†åŠŸèƒ½å°†ä¸å¯ç”¨ï¼Œæ•°æ®å°†ä»…ä¿å­˜åœ¨æœ¬åœ°',
    });

    // ç›´æ¥æ‰“å¼€ä¸»çª—å£ï¼ˆä¸éœ€è¦ç™»å½•ï¼‰
    createMainWindow();
  } else {
    // æœåŠ¡ç«¯å¯ç”¨ï¼Œæ­£å¸¸ç™»å½•æµç¨‹
    const isLoggedIn = await checkLoginStatus();
    if (isLoggedIn) {
      createMainWindow();
    } else {
      createLoginWindow();
    }
  }
});
```

### ç¦»çº¿åŠŸèƒ½é™åˆ¶

```typescript
// src/utils/offlineMode.ts

export function isOfflineMode(): boolean {
  return offlineMode;
}

export function getOfflineLimitations(): string[] {
  return [
    'æ— æ³•åŒæ­¥æ•°æ®åˆ°äº‘ç«¯',
    'æ— æ³•ä½¿ç”¨ Gemini æ¨¡å‹',
    'æ— æ³•ä½¿ç”¨ä»˜è´¹åŠŸèƒ½',
    'å¯¹è¯ä»…ä¿å­˜åœ¨æœ¬åœ°',
  ];
}

// åœ¨ UI ä¸­æ˜¾ç¤ºç¦»çº¿æç¤º
export function OfflineBanner() {
  const offline = isOfflineMode();

  if (!offline) return null;

  return (
    <Banner
      type="warning"
      closable={false}
      content={
        <div>
          <strong>ç¦»çº¿æ¨¡å¼</strong>
          <p>å½“å‰æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œéƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨</p>
        </div>
      }
    />
  );
}
```

---

## éƒ¨ç½²æ–¹æ¡ˆ

### å®¢æˆ·ç«¯éƒ¨ç½²

**1. ç¯å¢ƒå˜é‡**:

```bash
# .env.production
VITE_SERVER_API_URL=https://api.aionui.com
VITE_ENABLE_OFFLINE_MODE=true
VITE_APP_VERSION=1.0.0
```

**2. æ„å»º**:

```bash
# æ„å»ºå®¢æˆ·ç«¯
npm run build

# æ‰“åŒ… Electron åº”ç”¨
npm run package

# ç”Ÿæˆå®‰è£…åŒ…
npm run make
```

**3. è‡ªåŠ¨æ›´æ–°**:

```typescript
// src/main/updater.ts
import { autoUpdater } from 'electron-updater';

export function setupAutoUpdater() {
  autoUpdater.setFeedURL({
    provider: 'generic',
    url: 'https://updates.aionui.com',
  });

  autoUpdater.checkForUpdatesAndNotify();

  autoUpdater.on('update-available', () => {
    dialog.showMessageBox({
      type: 'info',
      title: 'å‘ç°æ–°ç‰ˆæœ¬',
      message: 'æ–°ç‰ˆæœ¬æ­£åœ¨ä¸‹è½½ä¸­...',
    });
  });

  autoUpdater.on('update-downloaded', () => {
    dialog
      .showMessageBox({
        type: 'info',
        title: 'æ›´æ–°å·²ä¸‹è½½',
        message: 'åº”ç”¨å°†åœ¨é‡å¯åæ›´æ–°',
        buttons: ['ç«‹å³é‡å¯', 'ç¨å'],
      })
      .then((result) => {
        if (result.response === 0) {
          autoUpdater.quitAndInstall();
        }
      });
  });
}
```

### æœåŠ¡ç«¯éƒ¨ç½²

**1. Docker éƒ¨ç½²**:

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 3001

CMD ["node", "server.js"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  api:
    build: .
    ports:
      - '3001:3001'
    environment:
      - NODE_ENV=production
      - JWT_SECRET=${JWT_SECRET}
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
    depends_on:
      - db
      - redis

  db:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=aionui
    volumes:
      - db_data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  db_data:
  redis_data:
```

**2. å¯åŠ¨æœåŠ¡**:

```bash
# ä½¿ç”¨ Docker Compose
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f api
```

**3. Nginx é…ç½®**:

```nginx
server {
    listen 443 ssl http2;
    server_name api.aionui.com;

    ssl_certificate /etc/letsencrypt/live/api.aionui.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.aionui.com/privkey.pem;

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
```

---

## æ€»ç»“

### å®ç°è¦ç‚¹

1. âœ… åº”ç”¨å¯åŠ¨æ—¶å¼ºåˆ¶æ£€æŸ¥ç™»å½•çŠ¶æ€
2. âœ… æä¾›å¤šç§ç™»å½•æ–¹å¼ï¼ˆå¯†ç /éªŒè¯ç ï¼‰
3. âœ… å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œå’Œç®¡ç†ç³»ç»Ÿ
4. âœ… åŸºäºè®¢é˜…ç­‰çº§çš„æƒé™æ§åˆ¶
5. âœ… Google è´¦å·ä½œä¸ºå¯é€‰ç»‘å®š
6. âœ… æ”¯æŒç¦»çº¿æ¨¡å¼é™çº§
7. âœ… æ•°æ®åŒæ­¥åˆ°æœåŠ¡ç«¯

### å¼€å‘æ—¶é—´ä¼°ç®—

- **å®¢æˆ·ç«¯æ”¹åŠ¨**: 8-12 å°æ—¶
  - ç™»å½•çª—å£: 3-4 å°æ—¶
  - IPC Bridge: 2-3 å°æ—¶
  - æƒé™æ£€æŸ¥: 2-3 å°æ—¶
  - ç¦»çº¿æ¨¡å¼: 1-2 å°æ—¶

- **æœåŠ¡ç«¯å®ç°**: 16-24 å°æ—¶
  - è®¤è¯ API: 4-6 å°æ—¶
  - ç”¨æˆ·ç®¡ç†: 3-4 å°æ—¶
  - è®¢é˜…ç³»ç»Ÿ: 4-6 å°æ—¶
  - æ•°æ®åº“è®¾è®¡: 2-3 å°æ—¶
  - æƒé™ä¸­é—´ä»¶: 3-5 å°æ—¶

- **æµ‹è¯•**: 8-12 å°æ—¶
- **éƒ¨ç½²**: 4-8 å°æ—¶
- **æ€»è®¡**: 36-56 å°æ—¶

### ä¸ Google ä¼˜å…ˆæ–¹æ¡ˆå¯¹æ¯”

| é¡¹ç›®       | Google ä¼˜å…ˆ | æœåŠ¡ç«¯ä¼˜å…ˆ |
| ---------- | ----------- | ---------- |
| å¼€å‘æ—¶é—´   | 11-22 å°æ—¶  | 36-56 å°æ—¶ |
| ç”¨æˆ·ä½“éªŒ   | â­â­â­â­â­  | â­â­â­     |
| å•†ä¸šåŒ–èƒ½åŠ› | â­â­        | â­â­â­â­â­ |
| ç»´æŠ¤æˆæœ¬   | ä½          | é«˜         |
| é€‚ç”¨åœºæ™¯   | ä¸ªäºº/å¼€æº   | å•†ä¸š/ä¼ä¸š  |

### å»ºè®®

- **å¦‚æœæ˜¯å¼€æºé¡¹ç›®æˆ–ä¸ªäººä½¿ç”¨** â†’ é€‰æ‹© Google ä¼˜å…ˆæ–¹æ¡ˆ
- **å¦‚æœæ˜¯å•†ä¸šåŒ–è¿è¥** â†’ é€‰æ‹©æœåŠ¡ç«¯ä¼˜å…ˆæ–¹æ¡ˆ
- **å¦‚æœéœ€è¦ä»˜è´¹è®¢é˜…** â†’ å¿…é¡»é€‰æ‹©æœåŠ¡ç«¯ä¼˜å…ˆæ–¹æ¡ˆ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-29  
**ä½œè€…**: Kiro AI Assistant
